//     Twig.js v0.3
//     Copyright (c) 2011 John Roepke
//     Available under the BSD 2-Clause License
//     https://github.com/justjohn/twig.js
var Twig=function(Twig){"use strict",Twig.trace=!1,Twig.debug=!1,Twig.cache=!0,Twig.Error=function(message){this.message=message,this.name="TwigException",this.type="TwigException"},Twig.Error.prototype.toString=function(){return this.name+": "+this.message},Twig.log={trace:function(){Twig.trace&&console&&console.log(Array.prototype.slice.call(arguments))},debug:function(){Twig.debug&&console&&console.log(Array.prototype.slice.call(arguments))}},Twig.token={},Twig.token.type={output:"output",logic:"logic",comment:"comment",raw:"raw"},Twig.token.definitions={output:{type:Twig.token.type.output,open:"{{",close:"}}"},logic:{type:Twig.token.type.logic,open:"{%",close:"%}"},comment:{type:Twig.token.type.comment,open:"{#",close:"#}"}},Twig.token.strings=['"',"'"],Twig.token.findStart=function(template){var output={position:null,def:null},token_type,token_template,first_key_position;for(token_type in Twig.token.definitions)Twig.token.definitions.hasOwnProperty(token_type)&&(token_template=Twig.token.definitions[token_type],first_key_position=template.indexOf(token_template.open),Twig.log.trace("Twig.token.findStart: ","Searching for ",token_template.open," found at ",first_key_position),first_key_position>=0&&(output.position===null||first_key_position<output.position)&&(output.position=first_key_position,output.def=token_template));return output},Twig.token.findEnd=function(template,token_def,start){var end=null,found=!1,offset=0,str_pos=null,str_found=null,pos=null,end_offset=null,this_str_pos=null,end_str_pos=null,i,l;while(!found){str_pos=null,str_found=null,pos=template.indexOf(token_def.close,offset);if(!(pos>=0))throw new Twig.Error("Unable to find closing bracket '"+token_def.close+"'"+" opened near template position "+start);end=pos,found=!0,l=Twig.token.strings.length;for(i=0;i<l;i+=1)this_str_pos=template.indexOf(Twig.token.strings[i],offset),this_str_pos>0&&this_str_pos<pos&&(str_pos===null||this_str_pos<str_pos)&&(str_pos=this_str_pos,str_found=Twig.token.strings[i]);if(str_pos!==null){end_offset=str_pos+1,end=null,found=!1;for(;;){end_str_pos=template.indexOf(str_found,end_offset);if(end_str_pos<0)throw"Unclosed string in template";if(template.substr(end_str_pos-1,1)!=="\\"){offset=end_str_pos+1;break}end_offset=end_str_pos+1}}}return end},Twig.tokenize=function(template){var tokens=[],error_offset=0,found_token=null,end=null;while(template.length>0)found_token=Twig.token.findStart(template),Twig.log.trace("Twig.tokenize: ","Found token: ",found_token),found_token.position!==null?(found_token.position>0&&tokens.push({type:Twig.token.type.raw,value:template.substring(0,found_token.position)}),template=template.substr(found_token.position+found_token.def.open.length),error_offset+=found_token.position+found_token.def.open.length,end=Twig.token.findEnd(template,found_token.def,error_offset),Twig.log.trace("Twig.tokenize: ","Token ends at ",end),tokens.push({type:found_token.def.type,value:template.substring(0,end).trim()}),template=template.substr(end+found_token.def.close.length),error_offset+=end+found_token.def.close.length):(tokens.push({type:Twig.token.type.raw,value:template}),template="");return tokens},Twig.compile=function(tokens){var output=[],stack=[],intermediate_output=[],token=null,logic_token=null,unclosed_token=null,prev_token=null,prev_template=null,tok_output=null,type=null,open=null,next=null;while(tokens.length>0){token=tokens.shift(),Twig.log.trace("Compiling token ",token);switch(token.type){case Twig.token.type.raw:stack.length>0?intermediate_output.push(token):output.push(token);break;case Twig.token.type.logic:logic_token=Twig.logic.compile.apply(this,[token]),type=logic_token.type,open=Twig.logic.handler[type].open,next=Twig.logic.handler[type].next,Twig.log.trace("Twig.compile: ","Compiled logic token to ",logic_token," next is: ",next," open is : ",open);if(open!==undefined&&!open){prev_token=stack.pop(),prev_template=Twig.logic.handler[prev_token.type];if(prev_template.next.indexOf(type)<0)throw new Error(type+" not expected after a "+prev_token.type);prev_token.output=prev_token.output||[],prev_token.output=prev_token.output.concat(intermediate_output),intermediate_output=[],tok_output={type:Twig.token.type.logic,token:prev_token},stack.length>0?intermediate_output.push(tok_output):output.push(tok_output)}next!==undefined&&next.length>0?(Twig.log.trace("Twig.compile: ","Pushing ",logic_token," to logic stack."),stack.length>0&&(prev_token=stack.pop(),prev_token.output=prev_token.output||[],prev_token.output=prev_token.output.concat(intermediate_output),stack.push(prev_token),intermediate_output=[]),stack.push(logic_token)):open!==undefined&&open&&(tok_output={type:Twig.token.type.logic,token:logic_token},stack.length>0?intermediate_output.push(tok_output):output.push(tok_output));break;case Twig.token.type.comment:break;case Twig.token.type.output:Twig.expression.compile.apply(this,[token]),stack.length>0?intermediate_output.push(token):output.push(token)}Twig.log.trace("Twig.compile: "," Output: ",output," Logic Stack: ",stack," Pending Output: ",intermediate_output)}if(stack.length>0)throw unclosed_token=stack.pop(),new Error("Unable to find an end tag for "+unclosed_token.type+", expecting one of "+unclosed_token.next.join(", "));return output},Twig.parse=function(tokens,context){var output=[],chain=!0,that=this;return context=context||{},tokens.forEach(function(token){Twig.log.debug("Twig.parse: ","Parsing token: ",token);switch(token.type){case Twig.token.type.raw:output.push(token.value);break;case Twig.token.type.logic:var logic_token=token.token,logic=Twig.logic.parse.apply(that,[logic_token,context,chain]);logic.chain!==undefined&&(chain=logic.chain),logic.context!==undefined&&(context=logic.context),logic.output!==undefined&&output.push(logic.output);break;case Twig.token.type.comment:break;case Twig.token.type.output:output.push(Twig.expression.parse.apply(that,[token.stack,context]))}}),output.join("")},Twig.prepare=function(data){var tokens,raw_tokens;return Twig.log.debug("Twig.prepare: ","Tokenizing ",data),raw_tokens=Twig.tokenize.apply(this,[data]),Twig.log.debug("Twig.prepare: ","Compiling ",raw_tokens),tokens=Twig.compile.apply(this,[raw_tokens]),Twig.log.debug("Twig.prepare: ","Compiled ",tokens),tokens},Twig.Templates={registry:{}},Twig.validateId=function(id){if(id==="prototype")throw new Twig.Error(id+" is not a valid twig identifier");if(Twig.Templates.registry.hasOwnProperty(id))throw new Twig.Error("There is already a template with the ID "+id);return!0},Twig.Templates.save=function(template){if(template.id===undefined)throw new Twig.Error("Unable to save template with no id");Twig.Templates.registry[template.id]=template},Twig.Templates.load=function(id){return Twig.Templates.registry.hasOwnProperty(id)?Twig.Templates.registry[id]:null},Twig.Templates.loadRemote=function(location,params,callback){var id=params.id,method=params.method,async=params.async,precompiled=params.precompiled,template=null;async===undefined&&(async=!0),id===undefined&&(id=location);if(Twig.cache&&Twig.Templates.registry.hasOwnProperty(id))return Twig.Templates.registry[id];if(method=="ajax"){if(typeof XMLHttpRequest=="undefined")throw new Error("Unsupported platform: Unable to do remote requests because there is no XMLHTTPRequest implementation");var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){var data=null;xmlhttp.readyState==4&&(Twig.log.debug("Got template ",xmlhttp.responseText),precompiled===!0?data=JSON.parse(xmlhttp.responseText):data=xmlhttp.responseText,template=new Twig.Template({data:data,id:id,url:location}),callback&&callback(template))},xmlhttp.open("GET",location,async),xmlhttp.send()}else(function(){var fs=require("fs"),data=null;async===!0?fs.readFile(location,"utf8",function(err,data){precompiled===!0&&(data=JSON.parse(data)),template=new Twig.Template({data:data,id:id,path:location}),callback&&callback(template)}):(data=fs.readFileSync(location,"utf8"),precompiled===!0&&(data=JSON.parse(data)),template=new Twig.Template({data:data,id:id,path:location}),callback&&callback(template))})();if(async===!1)return template};function is(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return obj!==undefined&&obj!==null&&clas===type}Twig.Template=function(params){var data=params.data,id=params.id,blocks=params.blocks,path=params.path,url=params.url;this.id=id,this.path=path,this.url=url,this.reset=function(){Twig.log.debug("Twig.Template.reset","Reseting template "+this.id),this.blocks={},this.child={blocks:blocks||{}},this.extend=null},this.reset(),is("String",data)?this.tokens=Twig.prepare.apply(this,[data]):this.tokens=data,this.render=function(context,params){params=params||{};var that=this,output,blocks=params.output=="blocks";return that.reset(),params.blocks&&(this.blocks=params.blocks),this.importBlocks=function(file,override){var url=relativePath(that,file),sub_template=Twig.Templates.loadRemote(url,{method:that.url?"ajax":"fs",async:!1,id:url}),key;override=override||!1,sub_template.render(context),Object.keys(sub_template.blocks).forEach(function(key){if(override||that.blocks[key]===undefined)that.blocks[key]=sub_template.blocks[key]})},output=Twig.parse.apply(this,[this.tokens,context]),this.extend?(url=relativePath(this,this.extend),this.parent=Twig.Templates.loadRemote(url,{method:this.url?"ajax":"fs",async:!1,id:url}),this.parent.render(context,{blocks:this.blocks})):blocks===!0?this.blocks:output},id!==undefined&&Twig.Templates.save(this)};function relativePath(template,file){var base,base_path,sep_chr="/",new_path=[],val;if(template.url)base=template.url;else{if(!template.path)throw new Twig.Error("Cannot extend an inline template.");base=template.path}base_path=base.split(sep_chr),base_path.pop(),base_path=base_path.concat(file.split(sep_chr));while(base_path.length>0)val=base_path.shift(),val!="."&&(val==".."&&new_path.length>0&&new_path[new_path.length-1]!=".."?new_path.pop():new_path.push(val));return new_path.join(sep_chr)}return Twig}(Twig||{});(function(){"use strict",Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(this===void 0||this===null)throw new TypeError;var t=Object(this),len=t.length>>>0;if(len===0)return-1;var n=0;arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:n!==0&&n!==Infinity&&n!==-Infinity&&(n=(n>0||-1)*Math.floor(Math.abs(n))));if(n>=len)return-1;var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(callback,thisArg){var T,k;if(this==null)throw new TypeError(" this is null or not defined");var O=Object(this),len=O.length>>>0;if({}.toString.call(callback)!="[object Function]")throw new TypeError(callback+" is not a function");thisArg&&(T=thisArg),k=0;while(k<len){var kValue;k in O&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}}),Object.keys||(Object.keys=function(o){if(o!==Object(o))throw new TypeError("Object.keys called on non-object");var ret=[],p;for(p in o)Object.prototype.hasOwnProperty.call(o,p)&&ret.push(p);return ret})})();var Twig=function(Twig){Twig.lib={};var sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input);return output.join("")}var str_format=function(){return str_format.cache.hasOwnProperty(arguments[0])||(str_format.cache[arguments[0]]=str_format.parse(arguments[0])),str_format.format.call(null,str_format.cache[arguments[0]],arguments)};return str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string")output.push(parse_tree[i]);else if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw sprintf('[sprintf] property "%s" does not exist',match[2][k]);arg=arg[match[2][k]]}}else match[1]?arg=argv[match[1]]:arg=argv[cursor++];if(/[^s]/.test(match[8])&&get_type(arg)!="number")throw sprintf("[sprintf] expecting number but found %s",get_type(arg));switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg,pad_character=match[4]?match[4]=="0"?"0":match[4].charAt(1):" ",pad_length=match[6]-String(arg).length,pad=match[6]?str_repeat(pad_character,pad_length):"",output.push(match[5]?arg+pad:pad+arg)}}return output.join("")},str_format.cache={},str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null)parse_tree.push(match[0]);else if((match=/^\x25{2}/.exec(_fmt))!==null)parse_tree.push("%");else{if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))===null)throw"[sprintf] huh?";if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))===null)throw"[sprintf] huh?";field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!=="")if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null)field_list.push(field_match[1]);else{if((field_match=/^\[(\d+)\]/.exec(replacement_field))===null)throw"[sprintf] huh?";field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(arg_names===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return parse_tree},str_format}(),vsprintf=function(fmt,argv){return argv.unshift(fmt),sprintf.apply(null,argv)};return Twig.lib.sprintf=sprintf,Twig.lib.vsprintf=vsprintf,function(){var jPaq={toString:function(){return"jPaq - A fully customizable JavaScript/JScript library created by Christopher West."}},shortDays="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),fullDays="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),shortMonths="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),fullMonths="January,February,March,April,May,June,July,August,September,October,November,December".split(",");function getOrdinalFor(intNum){return(intNum=Math.abs(intNum)%100)%10==1&&intNum!=11?"st":intNum%10==2&&intNum!=12?"nd":intNum%10==3&&intNum!=13?"rd":"th"}function getISO8601Year(aDate){var d=new Date(aDate.getFullYear()+1,0,4);return(d-aDate)/864e5<7&&(aDate.getDay()+6)%7<(d.getDay()+6)%7?d.getFullYear():aDate.getMonth()>0||aDate.getDate()>=4?aDate.getFullYear():aDate.getFullYear()-((aDate.getDay()+6)%7-aDate.getDate()>2?1:0)}function getISO8601Week(aDate){var d=new Date(getISO8601Year(aDate),0,4);return d.setDate(d.getDate()-(d.getDay()+6)%7),parseInt((aDate-d)/6048e5)+1}Date.prototype.setFromString=function(string){var parts;if(parts=string.match(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})T([0-9]{2})\:([0-9]{2})\:([0-9]{2})(\+|\-)([0-9]{2}):([0-9]{2})$/))this.setFullYear(parseInt(parts[1],10),parseInt(parts[2],10)-1,parseInt(parts[3],10)),this.setHours(parseInt(parts[4],10)),this.setMinutes(parseInt(parts[5],10)),this.setSeconds(parseInt(parts[6],10)),this.setMinutes(this.getMinutes()-parseInt(parts[7]+parts[8],10)*60-parseInt(parts[7]+parts[9],10)-this.getTimezoneOffset());else if(parts=string.match(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})\s([0-9]{2})\:([0-9]{2})\:?([0-9]{2})?$/))this.setFullYear(parseInt(parts[1],10),parseInt(parts[2],10)-1,parseInt(parts[3],10)),this.setHours(parseInt(parts[4],10)),this.setMinutes(parseInt(parts[5],10)),parts[6]&&this.setSeconds(parseInt(parts[6],10))||this.setSeconds(0);else{if(!(parts=string.match(/^([0-9]{4})\-([0-9]{2})\-([0-9]{2})$/)))throw new Error("Invalid string format");this.setFullYear(parseInt(parts[1],10),parseInt(parts[2],10)-1,parseInt(parts[3],10)),this.setHours(0),this.setMinutes(0),this.setSeconds(0)}return this},Date.prototype.format=function(format){if(typeof format!="string"||/^\s*$/.test(format))return this+"";var jan1st=new Date(this.getFullYear(),0,1),me=this;return format.replace(/[dDjlNSwzWFmMntLoYyaABgGhHisu]/g,function(option){switch(option){case"d":return("0"+me.getDate()).replace(/^.+(..)$/,"$1");case"D":return shortDays[me.getDay()];case"j":return me.getDate();case"l":return fullDays[me.getDay()];case"N":return(me.getDay()+6)%7+1;case"S":return getOrdinalFor(me.getDate());case"w":return me.getDay();case"z":return Math.ceil((jan1st-me)/864e5);case"W":return("0"+getISO8601Week(me)).replace(/^.(..)$/,"$1");case"F":return fullMonths[me.getMonth()];case"m":return("0"+(me.getMonth()+1)).replace(/^.+(..)$/,"$1");case"M":return shortMonths[me.getMonth()];case"n":return me.getMonth()+1;case"t":return(new Date(me.getFullYear(),me.getMonth()+1,-1)).getDate();case"L":return(new Date(me.getFullYear(),1,29)).getDate()==29?1:0;case"o":return getISO8601Year(me);case"Y":return me.getFullYear();case"y":return(me.getFullYear()+"").replace(/^.+(..)$/,"$1");case"a":return me.getHours()<12?"am":"pm";case"A":return me.getHours()<12?"AM":"PM";case"B":return Math.floor(((me.getUTCHours()+1)%24+me.getUTCMinutes()/60+me.getUTCSeconds()/3600)*1e3/24);case"g":return me.getHours()%12!=0?me.getHours()%12:12;case"G":return me.getHours();case"h":return("0"+(me.getHours()%12!=0?me.getHours()%12:12)).replace(/^.+(..)$/,"$1");case"H":return("0"+me.getHours()).replace(/^.+(..)$/,"$1");case"i":return("0"+me.getMinutes()).replace(/^.+(..)$/,"$1");case"s":return("0"+me.getSeconds()).replace(/^.+(..)$/,"$1");case"u":return me.getMilliseconds()}})}}(),Twig.lib.strip_tags=function(input,allowed){allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(commentsAndPhpTags,"").replace(tags,function($0,$1){return allowed.indexOf("<"+$1.toLowerCase()+">")>-1?$0:""})},Twig.lib.strtotime=function(str,now){var i,l,match,s,parse="";str=str.replace(/\s{2,}|^\s|\s$/g," "),str=str.replace(/[\t\r\n]/g,"");if(str==="now")return now===null||isNaN(now)?(new Date).getTime()/1e3|0:now|0;if(!isNaN(parse=Date.parse(str)))return parse/1e3|0;now?now=new Date(now*1e3):now=new Date,str=str.toLowerCase();var __is={day:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},mon:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"]},process=function(m){var ago=m[2]&&m[2]==="ago",num=(num=m[0]==="last"?-1:1)*(ago?-1:1);switch(m[0]){case"last":case"next":switch(m[1].substring(0,3)){case"yea":now.setFullYear(now.getFullYear()+num);break;case"wee":now.setDate(now.getDate()+num*7);break;case"day":now.setDate(now.getDate()+num);break;case"hou":now.setHours(now.getHours()+num);break;case"min":now.setMinutes(now.getMinutes()+num);break;case"sec":now.setSeconds(now.getSeconds()+num);break;case"mon":if(m[1]==="month"){now.setMonth(now.getMonth()+num);break};default:var day=__is.day[m[1].substring(0,3)];if(typeof day!="undefined"){var diff=day-now.getDay();diff===0?diff=7*num:diff>0?m[0]==="last"&&(diff-=7):m[0]==="next"&&(diff+=7),now.setDate(now.getDate()+diff),now.setHours(0,0,0,0)}}break;default:if(!/\d+/.test(m[0]))return!1;num*=parseInt(m[0],10);switch(m[1].substring(0,3)){case"yea":now.setFullYear(now.getFullYear()+num);break;case"mon":now.setMonth(now.getMonth()+num);break;case"wee":now.setDate(now.getDate()+num*7);break;case"day":now.setDate(now.getDate()+num);break;case"hou":now.setHours(now.getHours()+num);break;case"min":now.setMinutes(now.getMinutes()+num);break;case"sec":now.setSeconds(now.getSeconds()+num)}}return!0};match=str.match(/^(\d{2,4}-\d{2}-\d{2})(?:\s(\d{1,2}:\d{2}(:\d{2})?)?(?:\.(\d+))?)?$/);if(match!==null)return match[2]?match[3]||(match[2]+=":00"):match[2]="00:00:00",s=match[1].split(/-/g),s[1]=__is.mon[s[1]-1]||s[1],s[0]=+s[0],s[0]=s[0]>=0&&s[0]<=69?"20"+(s[0]<10?"0"+s[0]:s[0]+""):s[0]>=70&&s[0]<=99?"19"+s[0]:s[0]+"",parseInt(this.strtotime(s[2]+" "+s[1]+" "+s[0]+" "+match[2])+(match[4]?match[4]/1e3:""),10);var regex="([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday))(\\sago)?";match=str.match(new RegExp(regex,"gi"));if(match===null)return!1;for(i=0,l=match.length;i<l;i++)if(!process(match[i].split(" ")))return!1;return now.getTime()/1e3|0},Twig.lib.is=function(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return obj!==undefined&&obj!==null&&clas===type},Twig}(Twig||{}),Twig=function(Twig){"use strict",Twig.logic={},Twig.logic.type={if_:"Twig.logic.type.if",endif:"Twig.logic.type.endif",for_:"Twig.logic.type.for",endfor:"Twig.logic.type.endfor",else_:"Twig.logic.type.else",elseif:"Twig.logic.type.elseif",set:"Twig.logic.type.set",filter:"Twig.logic.type.filter",endfilter:"Twig.logic.type.endfilter",block:"Twig.logic.type.block",endblock:"Twig.logic.type.endblock",extends_:"Twig.logic.type.extends",use:"Twig.logic.type.use"},Twig.logic.definitions=[{type:Twig.logic.type.if_,regex:/^if\s+([^\s].+)$/,next:[Twig.logic.type.else_,Twig.logic.type.elseif,Twig.logic.type.endif],open:!0,compile:function(token){var expression=token.match[1];return token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,delete token.match,token},parse:function(token,context,chain){var output="",result=Twig.expression.parse.apply(this,[token.stack,context]);return chain=!0,result&&(chain=!1,output=Twig.parse.apply(this,[token.output,context])),{chain:chain,output:output}}},{type:Twig.logic.type.elseif,regex:/^elseif\s+([^\s].*)$/,next:[Twig.logic.type.else_,Twig.logic.type.elseif,Twig.logic.type.endif],open:!1,compile:function(token){var expression=token.match[1];return token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,delete token.match,token},parse:function(token,context,chain){var output="";return chain&&Twig.expression.parse.apply(this,[token.stack,context])===!0&&(chain=!1,output=Twig.parse.apply(this,[token.output,context])),{chain:chain,output:output}}},{type:Twig.logic.type.else_,regex:/^else$/,next:[Twig.logic.type.endif,Twig.logic.type.endfor],open:!1,parse:function(token,context,chain){var output="";return chain&&(output=Twig.parse.apply(this,[token.output,context])),{chain:chain,output:output}}},{type:Twig.logic.type.endif,regex:/^endif$/,next:[],open:!1},{type:Twig.logic.type.for_,regex:/^for\s+([a-zA-Z0-9_,\s]+)\s+in\s+([^\s].+)$/,next:[Twig.logic.type.else_,Twig.logic.type.endfor],open:!0,compile:function(token){var key_value=token.match[1],expression=token.match[2],kv_split=null,expression_stack=null;token.key_var=null,token.value_var=null;if(key_value.indexOf(",")>=0){kv_split=key_value.split(",");if(kv_split.length!==2)throw new Twig.Error("Invalid expression in for loop: "+key_value);token.key_var=kv_split[0].trim(),token.value_var=kv_split[1].trim()}else token.value_var=key_value;return expression_stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token.expression=expression_stack,delete token.match,token},parse:function(token,context,continue_chain){var result=Twig.expression.parse.apply(this,[token.expression,context]),output=[],key,keyset,that=this;return result instanceof Array?(key=0,result.forEach(function(value){var len=result.length;context[token.value_var]=value,token.key_var&&(context[token.key_var]=key),context.loop={index:key+1,index0:key,revindex:len-key,revindex0:len-key-1,first:key===0,last:key===len-1,length:len,parent:context},output.push(Twig.parse.apply(that,[token.output,context])),key+=1})):result instanceof Object&&(result._keys!==undefined?keyset=result._keys:keyset=Object.keys(result),keyset.forEach(function(key){if(key==="_keys")return;result.hasOwnProperty(key)&&(context[token.value_var]=result[key],token.key_var&&(context[token.key_var]=key),output.push(Twig.parse.apply(that,[token.output,context])))})),continue_chain=output.length===0,{chain:continue_chain,output:output.join("")}}},{type:Twig.logic.type.endfor,regex:/^endfor$/,next:[],open:!1},{type:Twig.logic.type.set,regex:/^set\s+([a-zA-Z0-9_,\s]+)\s*=\s*(.+)$/,next:[],open:!0,compile:function(token){var key=token.match[1].trim(),expression=token.match[2],expression_stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack;return token.key=key,token.expression=expression_stack,delete token.match,token},parse:function(token,context,continue_chain){var value=Twig.expression.parse.apply(this,[token.expression,context]),key=token.key;return context[key]=value,{chain:continue_chain,context:context}}},{type:Twig.logic.type.filter,regex:/^filter\s+(.+)$/,next:[Twig.logic.type.endfilter],open:!0,compile:function(token){var expression="|"+token.match[1].trim();return token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,delete token.match,token},parse:function(token,context,chain){var unfiltered=Twig.parse.apply(this,[token.output,context]),stack=[{type:Twig.expression.type.string,value:unfiltered}].concat(token.stack),output=Twig.expression.parse.apply(this,[stack,context]);return{chain:chain,output:output}}},{type:Twig.logic.type.endfilter,regex:/^endfilter$/,next:[],open:!1},{type:Twig.logic.type.block,regex:/^block\s+([a-zA-Z0-9_]+)$/,next:[Twig.logic.type.endblock],open:!0,compile:function(token){return token.block=token.match[1].trim(),delete token.match,token},parse:function(token,context,chain){var block_output="",output="";return this.blocks[token.block]===undefined&&(block_output=Twig.expression.parse.apply(this,[{type:Twig.expression.type.string,value:Twig.parse.apply(this,[token.output,context])},context]),this.blocks[token.block]=block_output),this.extend===null&&(this.child.blocks[token.block]?output=this.child.blocks[token.block]:output=this.blocks[token.block]),{chain:chain,output:output}}},{type:Twig.logic.type.endblock,regex:/^endblock$/,next:[],open:!1},{type:Twig.logic.type.extends_,regex:/^extends\s+(.+)$/,next:[],open:!0,compile:function(token){var expression=token.match[1].trim();return delete token.match,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token},parse:function(token,context,chain){var file=Twig.expression.parse.apply(this,[token.stack,context]);return this.extend=file,{chain:chain,output:""}}},{type:Twig.logic.type.use,regex:/^use\s+(.+)$/,next:[],open:!0,compile:function(token){var expression=token.match[1].trim();return delete token.match,token.stack=Twig.expression.compile.apply(this,[{type:Twig.expression.type.expression,value:expression}]).stack,token},parse:function(token,context,chain){var file=Twig.expression.parse.apply(this,[token.stack,context]);return this.importBlocks(file),{chain:chain,output:""}}}],Twig.logic.handler={},Twig.logic.extendType=function(type,value){value=value||"Twig.logic.type"+type,Twig.logic.type[type]=value},Twig.logic.extend=function(definition){if(!definition.type)throw new Twig.Error("Unable to extend logic definition. No type provided for "+definition);if(Twig.logic.type[definition.type])throw new Twig.Error("Unable to extend logic definitions. Type "+definition.type+" is already defined.");Twig.logic.extendType(definition.type),Twig.logic.handler[definition.type]=definition};while(Twig.logic.definitions.length>0)Twig.logic.extend(Twig.logic.definitions.shift());return Twig.logic.compile=function(raw_token){var expression=raw_token.value.trim(),token=Twig.logic.tokenize.apply(this,[expression]),token_template=Twig.logic.handler[token.type];return token_template.compile&&(token=token_template.compile.apply(this,[token]),Twig.log.trace("Twig.logic.compile: ","Compiled logic token to ",token)),token},Twig.logic.tokenize=function(expression){var token={},token_template_type=null,token_type=null,token_regex=null,regex_array=null,regex=null,match=null;expression=expression.trim();for(token_template_type in Twig.logic.handler)if(Twig.logic.handler.hasOwnProperty(token_template_type)){token_type=Twig.logic.handler[token_template_type].type,token_regex=Twig.logic.handler[token_template_type].regex,regex_array=[],token_regex instanceof Array?regex_array=token_regex:regex_array.push(token_regex);while(regex_array.length>0){regex=regex_array.shift(),match=regex.exec(expression.trim());if(match!==null)return token.type=token_type,token.match=match,Twig.log.trace("Twig.logic.tokenize: ","Matched a ",token_type," regular expression of ",match),token}}throw new Twig.Error("Unable to parse '"+expression.trim()+"'")},Twig.logic.parse=function(token,context,chain){var output="",token_template;return context=context||{},Twig.log.debug("Twig.logic.parse: ","Parsing logic token ",token),token_template=Twig.logic.handler[token.type],token_template.parse&&(output=token_template.parse.apply(this,[token,context,chain])),output},Twig}(Twig||{}),Twig=function(Twig){"use strict",Twig.expression={},Twig.expression.reservedWords=["true","false"],Twig.expression.type={comma:"Twig.expression.type.comma",expression:"Twig.expression.type.expression",operator:"Twig.expression.type.operator",string:"Twig.expression.type.string",bool:"Twig.expression.type.bool",array:{start:"Twig.expression.type.array.start",end:"Twig.expression.type.array.end"},object:{start:"Twig.expression.type.object.start",end:"Twig.expression.type.object.end"},parameter:{start:"Twig.expression.type.parameter.start",end:"Twig.expression.type.parameter.end"},key:{period:"Twig.expression.type.key.period",brackets:"Twig.expression.type.key.brackets"},filter:"Twig.expression.type.filter",_function:"Twig.expression.type._function",variable:"Twig.expression.type.variable",number:"Twig.expression.type.number",test:"Twig.expression.type.test"},Twig.expression.set={operations:[Twig.expression.type.filter,Twig.expression.type.operator,Twig.expression.type.array.end,Twig.expression.type.object.end,Twig.expression.type.parameter.end,Twig.expression.type.comma,Twig.expression.type.test],expressions:[Twig.expression.type._function,Twig.expression.type.expression,Twig.expression.type.bool,Twig.expression.type.string,Twig.expression.type.variable,Twig.expression.type.number,Twig.expression.type.array.start,Twig.expression.type.object.start]},Twig.expression.fn={compile:{push:function(token,stack,output){output.push(token)},push_both:function(token,stack,output){output.push(token),stack.push(token)}},parse:{push:function(token,stack,context){stack.push(token)},push_value:function(token,stack,context){stack.push(token.value)}}},Twig.expression.definitions=[{type:Twig.expression.type.test,regex:/^is\s+(not)?\s*([a-zA-Z_][a-zA-Z0-9_]*)/,next:Twig.expression.set.operations.concat([Twig.expression.type.parameter.start]),compile:function(token,stack,output){token.filter=token.match[2],token.modifier=token.match[1],delete token.match,delete token.value,output.push(token)},parse:function(token,stack,context){var value=stack.pop(),params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),result=Twig.test(token.filter,value,params);token.modifier=="not"?stack.push(!result):stack.push(result)}},{type:Twig.expression.type.comma,regex:/^,/,next:Twig.expression.set.expressions,compile:function(token,stack,output){var i=stack.length-1,stack_token;for(;i>=0;i--){stack_token=stack.pop();if(stack_token.type===Twig.expression.type.object.start||stack_token.type===Twig.expression.type.parameter.start||stack_token.type===Twig.expression.type.array.start){stack.push(stack_token);break}output.push(stack_token)}output.push(token)}},{type:Twig.expression.type.expression,regex:/^\(([^\)]+)\)/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period]),compile:function(token,stack,output
){token.value=token.match[1];var sub_stack=Twig.expression.compile(token).stack;while(sub_stack.length>0)output.push(sub_stack.shift())}},{type:Twig.expression.type.operator,regex:/(^[\+\-~%\?\:]|^[!=]==?|^[!<>]=?|^\|\||^&&|^\*\*?|^\/\/?|^and\s+|^or\s+|^not\s+)/,next:Twig.expression.set.expressions,compile:function(token,stack,output){delete token.match,token.value=token.value.trim();var value=token.value,operator=Twig.expression.operator.lookup(value,token);Twig.log.trace("Twig.expression.compile: ","Operator: ",operator," from ",value);while(stack.length>0&&stack[stack.length-1].type==Twig.expression.type.operator&&(operator.associativity===Twig.expression.operator.leftToRight&&operator.precidence>=stack[stack.length-1].precidence||operator.associativity===Twig.expression.operator.rightToLeft&&operator.precidence>stack[stack.length-1].precidence)){var temp=stack.pop();output.push(temp)}if(value===":"){if(!stack[stack.length-1]||stack[stack.length-1].value!=="?"){var key_token=output.pop();if(key_token.type!==Twig.expression.type.string)throw new Twig.Error("Unexpected value before ':' of "+key_token.type+" = "+key_token.value);token.key=key_token.value,output.push(token);return}}else stack.push(operator)},parse:function(token,stack,context){token.key?stack.push(token):Twig.expression.operator.parse(token.value,stack)}},{type:Twig.expression.type.string,regex:/^(["'])(?:(?=(\\?))\2.)*?\1/,next:Twig.expression.set.operations,compile:function(token,stack,output){var value=token.value;value.substring(0,1)==='"'?value=value.replace('\\"','"'):value=value.replace("\\'","'"),token.value=value.substring(1,value.length-1),Twig.log.trace("Twig.expression.compile: ","String value: ",token.value),output.push(token)},parse:Twig.expression.fn.parse.push_value},{type:Twig.expression.type.parameter.start,regex:/^\(/,next:Twig.expression.set.expressions.concat([Twig.expression.type.parameter.end]),compile:Twig.expression.fn.compile.push_both,parse:Twig.expression.fn.parse.push},{type:Twig.expression.type.parameter.end,regex:/^\)/,next:Twig.expression.set.operations,compile:function(token,stack,output){var stack_token;stack_token=stack.pop();while(stack.length>0&&stack_token.type!=Twig.expression.type.parameter.start)output.push(stack_token),stack_token=stack.pop();var param_stack=[];while(token.type!==Twig.expression.type.parameter.start)param_stack.unshift(token),token=output.pop();param_stack.unshift(token),token=output.pop();if(token.type!==Twig.expression.type._function&&token.type!==Twig.expression.type.filter&&token.type!==Twig.expression.type.test&&token.type!==Twig.expression.type.key.brackets&&token.type!==Twig.expression.type.key.period)throw new Twig.Error("Expected filter or function before parameters, got "+token.type);token.params=param_stack,output.push(token)},parse:function(token,stack,context){var new_array=[],array_ended=!1,value=null;while(stack.length>0){value=stack.pop();if(value&&value.type&&value.type==Twig.expression.type.parameter.start){array_ended=!0;break}new_array.unshift(value)}if(!array_ended)throw new Twig.Error("Expected end of parameter set.");stack.push(new_array)}},{type:Twig.expression.type.array.start,regex:/^\[/,next:Twig.expression.set.expressions.concat([Twig.expression.type.array.end]),compile:Twig.expression.fn.compile.push_both,parse:Twig.expression.fn.parse.push},{type:Twig.expression.type.array.end,regex:/^\]/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets]),compile:function(token,stack,output){var i=stack.length-1,stack_token;for(;i>=0;i--){stack_token=stack.pop();if(stack_token.type===Twig.expression.type.array.start)break;output.push(stack_token)}output.push(token)},parse:function(token,stack,context){var new_array=[],array_ended=!1,value=null;while(stack.length>0){value=stack.pop();if(value.type&&value.type==Twig.expression.type.array.start){array_ended=!0;break}new_array.unshift(value)}if(!array_ended)throw new Twig.Error("Expected end of array.");stack.push(new_array)}},{type:Twig.expression.type.object.start,regex:/^\{/,next:Twig.expression.set.expressions.concat([Twig.expression.type.object.end]),compile:Twig.expression.fn.compile.push_both,parse:Twig.expression.fn.parse.push},{type:Twig.expression.type.object.end,regex:/^\}/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets]),compile:function(token,stack,output){var i=stack.length-1,stack_token;for(;i>=0;i--){stack_token=stack.pop();if(stack_token.type===Twig.expression.type.object.start)break;output.push(stack_token)}output.push(token)},parse:function(end_token,stack,context){var new_object={},object_ended=!1,token=null,token_key=null,value=null;while(stack.length>0){token=stack.pop();if(token.type&&token.type===Twig.expression.type.object.start){object_ended=!0;break}if(token.type&&token.type===Twig.expression.type.operator&&token.key){if(value===null)throw new Twig.Error("Expected value for key "+token.key+" in object definition. Got "+token);new_object[token.key]=value,new_object._keys===undefined&&(new_object._keys=[]),new_object._keys.unshift(token.key),value=null}else value=token}if(!object_ended)throw new Twig.Error("Unexpected end of object.");stack.push(new_object)}},{type:Twig.expression.type.filter,regex:/^\|\s?([a-zA-Z_][a-zA-Z0-9_\-]*)/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets,Twig.expression.type.parameter.start]),compile:function(token,stack,output){token.value=token.match[1],output.push(token)},parse:function(token,stack,context){var input=stack.pop(),params=token.params&&Twig.expression.parse.apply(this,[token.params,context]);stack.push(Twig.filter(token.value,input,params))}},{type:Twig.expression.type._function,regex:/^([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/,next:Twig.expression.type.parameter.start,transform:function(match,tokens){return"("},compile:function(token,stack,output){var fn=token.match[1];token.fn=fn,delete token.match,delete token.value,output.push(token)},parse:function(token,stack,context){var params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),fn=token.fn,value;if(Twig.functions[fn])value=Twig.functions[fn].apply(this,params);else{if(typeof context[fn]!="function")throw new Twig.Error(fn+" function does not exist and is not defined in the context");value=context[fn].apply(context,params)}stack.push(value)}},{type:Twig.expression.type.variable,regex:/^[a-zA-Z_][a-zA-Z0-9_]*/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets,Twig.expression.type.parameter.start]),compile:Twig.expression.fn.compile.push,validate:function(match,tokens){return Twig.expression.reservedWords.indexOf(match[0])==-1},parse:function(token,stack,context){var value=Twig.expression.resolve(context[token.value],context);stack.push(value)}},{type:Twig.expression.type.key.period,regex:/^\.([a-zA-Z_][a-zA-Z0-9_]*)/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets,Twig.expression.type.parameter.start]),compile:function(token,stack,output){token.key=token.match[1],delete token.match,delete token.value,output.push(token)},parse:function(token,stack,context){var params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),key=token.key,object=stack.pop(),value;if(object===null||object===undefined)throw new Twig.Error("Can't access a key "+key+" on an undefined object.");value=object[key],stack.push(Twig.expression.resolve(value,object,params))}},{type:Twig.expression.type.key.brackets,regex:/^\[([^\]]*)\]/,next:Twig.expression.set.operations.concat([Twig.expression.type.key.period,Twig.expression.type.key.brackets,Twig.expression.type.parameter.start]),compile:function(token,stack,output){var match=token.match[1];delete token.value,delete token.match,token.stack=Twig.expression.compile({value:match}).stack,output.push(token)},parse:function(token,stack,context){var params=token.params&&Twig.expression.parse.apply(this,[token.params,context]),key=Twig.expression.parse.apply(this,[token.stack,context]),object=stack.pop(),value;if(!object.hasOwnProperty(key))throw new Twig.Error("Model doesn't provide the key "+key);value=object[key],stack.push(Twig.expression.resolve(value,context,params))}},{type:Twig.expression.type.number,regex:/^\-?\d+(\.\d+)?/,next:Twig.expression.set.operations,compile:function(token,stack,output){token.value=Number(token.value),output.push(token)},parse:Twig.expression.fn.parse.push_value},{type:Twig.expression.type.bool,regex:/^(true|false)/,next:Twig.expression.set.operations,compile:function(token,stack,output){token.value=token.match[0]=="true",delete token.match,output.push(token)},parse:Twig.expression.fn.parse.push_value}],Twig.expression.resolve=function(value,context,params){return typeof value=="function"?value.apply(context,params||[]):value},Twig.expression.handler={},Twig.expression.extendType=function(type){Twig.expression.type[type]="Twig.expression.type."+type},Twig.expression.extend=function(definition){if(!definition.type)throw new Twig.Error("Unable to extend logic definition. No type provided for "+definition);Twig.expression.handler[definition.type]=definition};while(Twig.expression.definitions.length>0)Twig.expression.extend(Twig.expression.definitions.shift());return Twig.expression.tokenize=function(expression){var tokens=[],exp_offset=0,next=null,type,regex,regex_array,token_next,match_found,invalid_matches=[],match_function;match_function=function(){var match=Array.prototype.slice.apply(arguments),string=match.pop(),offset=match.pop();return Twig.log.trace("Twig.expression.tokenize","Matched a ",type," regular expression of ",match),next&&next.indexOf(type)<0?(invalid_matches.push(type+" cannot follow a "+tokens[tokens.length-1].type+" at template:"+exp_offset+" near '"+match[0].substring(0,20)+"...'"),match[0]):Twig.expression.handler[type].validate&&!Twig.expression.handler[type].validate(match,tokens)?match[0]:(invalid_matches=[],tokens.push({type:type,value:match[0],match:match}),match_found=!0,next=token_next,exp_offset+=match[0].length,Twig.expression.handler[type].transform?Twig.expression.handler[type].transform(match,tokens):"")},Twig.log.debug("Twig.expression.tokenize","Tokenizing expression ",expression);while(expression.length>0){expression=expression.trim();for(type in Twig.expression.handler)if(Twig.expression.handler.hasOwnProperty(type)){token_next=Twig.expression.handler[type].next,regex=Twig.expression.handler[type].regex,regex instanceof Array?regex_array=regex:regex_array=[regex],match_found=!1;while(regex_array.length>0)regex=regex_array.pop(),expression=expression.replace(regex,match_function);if(match_found)break}if(!match_found)throw invalid_matches.length>0?new Twig.Error(invalid_matches.join(" OR ")):new Twig.Error("Unable to parse '"+expression+"' at template position"+exp_offset)}return Twig.log.trace("Twig.expression.tokenize","Tokenized to ",tokens),tokens},Twig.expression.compile=function(raw_token){var expression=raw_token.value,tokens=Twig.expression.tokenize(expression),token=null,output=[],stack=[],token_template=null;Twig.log.trace("Twig.expression.compile: ","Compiling ",expression);while(tokens.length>0)token=tokens.shift(),token_template=Twig.expression.handler[token.type],Twig.log.trace("Twig.expression.compile: ","Compiling ",token),token_template.compile&&token_template.compile(token,stack,output),Twig.log.trace("Twig.expression.compile: ","Stack is",stack),Twig.log.trace("Twig.expression.compile: ","Output is",output);while(stack.length>0)output.push(stack.pop());return Twig.log.trace("Twig.expression.compile: ","Final output is",output),raw_token.stack=output,delete raw_token.value,raw_token},Twig.expression.parse=function(tokens,context){var that=this;tokens instanceof Array||(tokens=[tokens]);var stack=[],token_template=null;return tokens.forEach(function(token){token_template=Twig.expression.handler[token.type],token_template.parse&&token_template.parse.apply(that,[token,stack,context])}),stack.pop()},Twig}(Twig||{}),Twig=function(Twig){return"use strict",Twig.expression.operator={leftToRight:"leftToRight",rightToLeft:"rightToLeft"},Twig.expression.operator.lookup=function(operator,token){switch(operator){case",":token.precidence=18,token.associativity=Twig.expression.operator.leftToRight;break;case"?":case":":token.precidence=16,token.associativity=Twig.expression.operator.rightToLeft;break;case"or":case"||":token.precidence=14,token.associativity=Twig.expression.operator.leftToRight;break;case"and":case"&&":token.precidence=13,token.associativity=Twig.expression.operator.leftToRight;break;case"==":case"!=":token.precidence=9,token.associativity=Twig.expression.operator.leftToRight;break;case"<":case"<=":case">":case">=":token.precidence=8,token.associativity=Twig.expression.operator.leftToRight;break;case"~":case"+":case"-":token.precidence=6,token.associativity=Twig.expression.operator.leftToRight;break;case"//":case"**":case"*":case"/":case"%":token.precidence=5,token.associativity=Twig.expression.operator.leftToRight;break;case"not":token.precidence=3,token.associativity=Twig.expression.operator.rightToLeft;break;default:throw new Twig.Error(operator+" is an unknown operator.")}return token.operator=operator,token},Twig.expression.operator.parse=function(operator,stack){Twig.log.trace("Twig.expression.operator.parse: ","Handling ",operator);var a,b,c;switch(operator){case":":break;case"?":c=stack.pop(),b=stack.pop(),a=stack.pop(),a?stack.push(b):stack.push(c);break;case"+":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a+b);break;case"-":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a-b);break;case"*":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a*b);break;case"/":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a/b);break;case"//":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(parseInt(a/b));break;case"%":b=parseFloat(stack.pop()),a=parseFloat(stack.pop()),stack.push(a%b);break;case"~":b=stack.pop(),a=stack.pop(),stack.push((a!==undefined?a.toString():"")+(b!==undefined?b.toString():""));break;case"not":case"!":stack.push(!stack.pop());break;case"<":b=stack.pop(),a=stack.pop(),stack.push(a<b);break;case"<=":b=stack.pop(),a=stack.pop(),stack.push(a<=b);break;case">":b=stack.pop(),a=stack.pop(),stack.push(a>b);break;case">=":b=stack.pop(),a=stack.pop(),stack.push(a>=b);break;case"===":b=stack.pop(),a=stack.pop(),stack.push(a===b);break;case"==":b=stack.pop(),a=stack.pop(),stack.push(a==b);break;case"!==":b=stack.pop(),a=stack.pop(),stack.push(a!==b);break;case"!=":b=stack.pop(),a=stack.pop(),stack.push(a!=b);break;case"or":case"||":b=stack.pop(),a=stack.pop(),stack.push(a||b);break;case"and":case"&&":b=stack.pop(),a=stack.pop(),stack.push(a&&b);break;case"**":b=stack.pop(),a=stack.pop(),stack.push(Math.pow(a,b));break;default:throw new Twig.Error(operator+" is an unknown operator.")}},Twig}(Twig||{}),Twig=function(Twig){function is(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return obj!==undefined&&obj!==null&&clas===type}return Twig.filters={upper:function(value){return value.toUpperCase()},lower:function(value){return value.toLowerCase()},capitalize:function(value){return value.substr(0,1).toUpperCase()+value.substr(1)},title:function(value){return value.replace(/(^|\s)([a-z])/g,function(m,p1,p2){return p1+p2.toUpperCase()})},length:function(value){if(value instanceof Array||typeof value=="string")return value.length;if(value instanceof Object)return value._keys===undefined?Object.keys(value).length:value._keys.length},reverse:function(value){if(is("Array",value))return value.reverse();if(is("String",value))return value.split("").reverse().join("");var keys=value._keys||Object.keys(value).reverse();return value._keys=keys,value},sort:function(value){if(is("Array",value))return value.sort();if(value instanceof Object){delete value._keys;var keys=Object.keys(value),sorted_keys=keys.sort(function(a,b){return value[a]>value[b]});return value._keys=sorted_keys,value}},keys:function(value){var keyset=value._keys||Object.keys(value),output=[];return keyset.forEach(function(key){if(key==="_keys")return;value.hasOwnProperty(key)&&output.push(key)}),output},url_encode:function(value){return encodeURIComponent(value)},join:function(value,params){var join_str="",output=[],keyset=null;return params&&params[0]&&(join_str=params[0]),value instanceof Array?output=value:(keyset=value._keys||Object.keys(value),keyset.forEach(function(key){if(key==="_keys")return;value.hasOwnProperty(key)&&output.push(value[key])})),output.join(join_str)},"default":function(value,params){if(params===undefined||params.length!==1)throw new Twig.Error("default filter expects one argument");return value===undefined||value===null||value===""?params[0]:value},json_encode:function(value){return delete value._keys,JSON.stringify(value)},merge:function(value,params){var obj=[],arr_index=0,keyset=[];value instanceof Array?params.forEach(function(param){param instanceof Array||(obj={})}):obj={},obj instanceof Array||(obj._keys=[]),value instanceof Array?value.forEach(function(val){obj._keys&&obj._keys.unshift(arr_index),obj[arr_index]=val,arr_index++}):(keyset=value._keys||Object.keys(value),keyset.forEach(function(key){obj[key]=value[key],obj._keys.push(key);var int_key=parseInt(key,10);!isNaN(int_key)&&int_key>=arr_index&&(arr_index=int_key+1)})),params.forEach(function(param){param instanceof Array?param.forEach(function(val){obj._keys&&obj._keys.push(arr_index),obj[arr_index]=val,arr_index++}):(keyset=param._keys||Object.keys(param),keyset.forEach(function(key){obj[key]||obj._keys.unshift(key),obj[key]=param[key];var int_key=parseInt(key,10);!isNaN(int_key)&&int_key>=arr_index&&(arr_index=int_key+1)}))});if(params.length===0)throw new Twig.Error("Filter merge expects at least one parameter");return obj},date:function(value,params){var date=new Date(value);return date.getDate()===NaN&&date.setFromString(value),date.format(params[0])},replace:function(value,params){var pairs=params[0],tag;for(tag in pairs)pairs.hasOwnProperty(tag)&&tag!=="_keys"&&(value=value.replace(tag,pairs[tag]));return value},format:function(value,params){return Twig.lib.vsprintf(value,params)},striptags:function(value){return Twig.lib.strip_tags(value)}},Twig.filter=function(filter,value,params){if(!Twig.filters[filter])throw"Unable to find filter "+filter;return Twig.filters[filter](value,params)},Twig.filter.extend=function(filter,definition){Twig.filters[filter]=definition},Twig}(Twig||{}),Twig=function(Twig){function is(type,obj){var clas=Object.prototype.toString.call(obj).slice(8,-1);return obj!==undefined&&obj!==null&&clas===type}return Twig.functions={range:function(low,high,step){var matrix=[],inival,endval,plus,walker=step||1,chars=!1;!isNaN(low)&&!isNaN(high)?(inival=parseInt(low),endval=parseInt(high)):isNaN(low)&&isNaN(high)?(chars=!0,inival=low.charCodeAt(0),endval=high.charCodeAt(0)):(inival=isNaN(low)?0:low,endval=isNaN(high)?0:high),plus=inival>endval?!1:!0;if(plus)while(inival<=endval)matrix.push(chars?String.fromCharCode(inival):inival),inival+=walker;else while(inival>=endval)matrix.push(chars?String.fromCharCode(inival):inival),inival-=walker;return matrix},cycle:function(arr,i){var pos=i%arr.length;return arr[pos]},date:function(date,time){var dateObj;if(date==undefined)dateObj=new Date;else if(Twig.lib.is("Date",date))dateObj=date;else if(Twig.lib.is("String",date))dateObj=new Date(Twig.lib.strtotime(date)*1e3);else{if(!Twig.lib.is("Number",date))throw new Twig.Error("Unable to parse date "+date);dateObj=new Date(date*1e3)}return dateObj}},Twig._function=function(_function,value,params){if(!Twig.functions[_function])throw"Unable to find function "+_function;return Twig.functions[_function](value,params)},Twig._function.extend=function(_function,definition){Twig.functions[_function]=definition},Twig}(Twig||{}),Twig=function(Twig){return"use strict",Twig.tests={empty:function(value){if(value===null||value===undefined)return!0;if(typeof value=="number")return!1;if(value.length&&value.length>0)return!1;for(var key in value)if(value.hasOwnProperty(key))return!1;return!0},odd:function(value){return value%2===1},even:function(value){return value%2===0},divisibleby:function(value,params){return value%params[0]===0},defined:function(value){return value!==undefined},none:function(value){return value===null},sameas:function(value,params){return value===params[0]}},Twig.test=function(test,value,params){if(!Twig.tests[test])throw"Test "+test+" is not defined.";return Twig.tests[test](value,params)},Twig.test.extend=function(test,definition){Twig.tests[test]=definition},Twig}(Twig||{}),Twig=function(Twig){return"use strict",Twig.exports={},Twig.exports.twig=function twig(params){"use strict";var id=params.id;id&&Twig.validateId(id),params.debug!==undefined&&(Twig.debug=params.debug),params.trace!==undefined&&(Twig.trace=params.trace);if(params.data!==undefined)return new Twig.Template({data:params.data,id:id});if(params.ref!==undefined){if(params.id!==undefined)throw new Error("Both ref and id cannot be set on a twig.js template.");return Twig.Templates.load(params.ref)}if(params.href!==undefined)return Twig.Templates.loadRemote(params.href,{id:id,precompiled:params.precompiled,method:"ajax",async:params.async},params.load);if(params.path!==undefined)return Twig.Templates.loadRemote(params.path,{id:id,precompiled:params.precompiled,method:"fs",async:params.async},params.load)},Twig.exports.extendFilter=function(filter,definition){Twig.filter.extend(filter,definition)},Twig.exports.extendFunction=function(fn,definition){Twig._function.extend(fn,definition)},Twig.exports.extendTest=function(test,definition){Twig.test.extend(test,definition)},Twig.exports.extendTag=function(definition){Twig.logic.extend(definition)},Twig.exports.compile=function(markup,options){var id=options.filename,sep_chr="/",path=options.filename,template;return template=new Twig.Template({data:markup,path:path,id:id}),function(context){return template.render(context)}},Twig.exports.cache=function(cache){Twig.cache=cache},Twig}(Twig||{});typeof module!="undefined"&&module.declare?module.declare([],function(require,exports,module){for(key in Twig.exports)Twig.exports.hasOwnProperty(key)&&(exports[key]=Twig.exports[key])}):typeof module!="undefined"&&module.exports?module.exports=Twig.exports:(window.twig=Twig.exports.twig,window.Twig=Twig.exports);